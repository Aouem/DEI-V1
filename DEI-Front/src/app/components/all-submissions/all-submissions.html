<div class="submissions-container">
  <h1>Historique des soumissions</h1>

  <!-- Filtre par Incident ID -->
  <div class="filter-container" *ngIf="!isLoading && !hasError">
    <label for="incidentFilter">Filtrer par Incident ID:</label>
    <input 
      type="number" 
      id="incidentFilter" 
      [(ngModel)]="incidentFilter"
      (input)="applyFilters()"
      placeholder="ID de l'incident..."
      min="1"
    >
    <button (click)="clearFilter()" class="clear-filter-btn">×</button>
  </div>

  <!-- Message de chargement -->
  <div *ngIf="isLoading" class="loading-message">
    <div>Chargement des soumissions...</div>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="hasError && !isLoading" class="error-message">
    <p>Erreur lors du chargement des soumissions.</p>
    <button (click)="reloadData()" class="reload-btn">Réessayer le chargement</button>
  </div>

  <!-- Contenu principal -->
  <div *ngIf="!isLoading && !hasError && submissions.length > 0">
    <!-- Statistiques -->
    <div class="stats">
      <strong>Total:</strong> {{submissions.length}} soumissions | 
      <strong>Affichées:</strong> {{filteredSubmissions.length}}
    </div>

    <!-- Tableau des soumissions -->
    <table class="submissions-table">
      <thead>
        <tr>
          <th>ID Grille</th>
          <th>Date</th>
          <th>Réponses</th>
          <th>Incident ID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let sub of pagedSubmissions; trackBy: trackBySubmissionId">
          <td>{{ sub.id }}</td>
          <td>{{ sub.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ sub.reponses.length || 0 }}</td>
          <td>
            <span *ngIf="getIncidentId(sub); else noIncident" class="incident-id">
              {{ getIncidentId(sub) }}
            </span>
            <ng-template #noIncident>
              <span class="no-incident">-</span>
            </ng-template>
          </td>
          <td>
            <button class="view-btn" (click)="viewSubmission(sub.id)">Voir</button>
            <!-- <button class="delete-btn" (click)="deleteSubmission(sub)">Supprimer</button> -->
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages() > 1">
      <button (click)="prevPage()" [disabled]="currentPage === 1">‹ Précédent</button>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages()">Suivant ›</button>
    </div>
  </div>

  <!-- Aucune soumission -->
  <div *ngIf="!isLoading && !hasError && submissions.length === 0" class="no-submissions">
    Aucune soumission enregistrée.
  </div>

  <!-- Aucun résultat après filtrage -->
  <div *ngIf="!isLoading && !hasError && submissions.length > 0 && filteredSubmissions.length === 0" class="no-results">
    <p>Aucune soumission trouvée pour l'Incident ID: <strong>{{ incidentFilter }}</strong></p>
  </div>
</div>
