<div class="filter-container mb-4 d-flex flex-wrap align-items-center gap-2">
  <!-- Zone de recherche créative -->
  <div class="input-group shadow-sm rounded-pill flex-grow-1" style="height: 40px;">
    <span class="input-group-text bg-white pe-2">
      <i class="bi bi-search"></i>
    </span>
    <input type="text" class="form-control border-0" placeholder="Rechercher par code..."
           [(ngModel)]="filterCode" (input)="applyFilter()"
           style="height: 38px; padding: 0 10px; font-size: 0.9rem;" />
    <button *ngIf="filterCode" class="btn btn-outline-secondary p-0 d-flex align-items-center justify-content-center"
            (click)="filterCode=''; applyFilter()" style="width: 30px; height: 30px; border-radius: 50%;">
      <i class="bi bi-x-lg" style="font-size: 0.85rem;"></i>
    </button>
  </div>

  <!-- Filtre par statut au même style et hauteur -->
  <select class="form-select shadow-sm rounded-pill flex-grow-1" [(ngModel)]="filterStatut" (change)="applyFilter()"
          style="height: 40px; font-size: 0.9rem; min-width: 180px;">
    <option value="ALL">Tous les statuts</option>
    <option value="BROUILLON">Brouillon</option>
    <option value="SOUMIS">Soumis</option>
    <option value="ENCOURSANALYSE">En cours analyse</option>
    <option value="ACTIONREQUIS">Action requise</option>
    <option value="RESOLU">Résolu</option>
    <option value="CLOTURE">Clôturé</option>
  </select>
</div>


<div class="table-responsive rounded-4 shadow-sm">
  <h3 class="mb-3 fw-bold text-primary text-center">
    Liste des incidents
  </h3>

  <table class="table table-hover align-middle mb-0">
    <thead>
      <tr class="incident-table-header">
        <th class="ps-4 py-3">Code</th>
        <th class="py-3">Date</th>
        <th class="py-3">Gravité</th>
        <th class="py-3">Service</th>
        <th class="pe-4 py-3">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let incident of paginatedIncidents" class="incident-row">
        <td class="ps-4 fw-bold font-monospace">
          {{ incident.code }}
          <span *ngIf="isNewIncident(incident.id)" class="new-incident">
            <i class="bi bi-lightbulb-fill"></i>
          </span>
        </td>

        <td>{{ getDateFromCode(incident.code) }}</td>

        <td>
          <div class="gravity-indicator rounded-pill overflow-hidden" [style.background]="getGraviteGradient(incident.gravite)">
            <div class="gravity-level" [style.width.%]="getGraviteLevel(incident.gravite)"></div>
            <span class="gravity-label">{{ getGraviteLabel(incident.gravite) }}</span>
          </div>
        </td>

        <td>
          <span class="badge bg-primary">{{ getServiceName(incident) }}</span>
        </td>

        <td class="pe-4 d-flex gap-2">
          <button class="btn btn-action" (click)="openIncident(incident, 'view')" title="Voir">
            <i class="bi bi-eye"></i>
          </button>
          <button class="btn btn-warning" (click)="openIncident(incident, 'edit')" title="Modifier">
            <i class="bi bi-pencil"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="d-flex justify-content-between align-items-center mt-3">
  <button class="btn btn-secondary" (click)="prevPage()" [disabled]="currentPage === 1">
    Précédent
  </button>

  <div>
    <button *ngFor="let page of pages"
            class="btn"
            [ngClass]="{'btn-primary': page === currentPage, 'btn-outline-primary': page !== currentPage}"
            (click)="goToPage(page)">
      {{ page }}
    </button>
  </div>

  <button class="btn btn-secondary" (click)="nextPage()" [disabled]="currentPage === totalPages">
    Suivant
  </button>
</div>
