<body class="bg-light d-flex justify-content-center align-items-center min-vh-100">
  <div class="card w-100 shadow-lg rounded-4" style="max-width: 800px;">
    <div class="card-header bg-primary text-white text-center rounded-top-4">
      <h3 class="mb-0">Création d'utilisateur</h3>
      <small>Gestion des comptes – Application hospitalière</small>
    </div>

    <div class="card-body">
      <!-- Message de chargement -->
      <div *ngIf="isSubmitting" class="alert alert-info">
        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
        Création en cours... Veuillez patienter.
      </div>

      <!-- Message d'erreur général -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
      </div>

      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <!-- Nom d'utilisateur -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-person-fill text-primary me-2"></i> Nom d'utilisateur*
          </label>
          <div class="col-sm-8">
            <input type="text" 
                   class="form-control" 
                   [class.is-invalid]="userForm.get('userName')?.invalid && userForm.get('userName')?.touched"
                   formControlName="userName">
            <div class="invalid-feedback">
              <div *ngIf="userForm.get('userName')?.errors?.['required']">
                Ce champ est obligatoire
              </div>
              <div *ngIf="userForm.get('userName')?.errors?.['minlength']">
                Minimum 3 caractères
              </div>
            </div>
          </div>
        </div>

        <!-- Email -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-envelope-fill text-primary me-2"></i> Email*
          </label>
          <div class="col-sm-8">
            <input type="email" 
                   class="form-control" 
                   [class.is-invalid]="userForm.get('email')?.invalid && userForm.get('email')?.touched"
                   formControlName="email">
            <div class="invalid-feedback">
              <div *ngIf="userForm.get('email')?.errors?.['required']">
                Ce champ est obligatoire
              </div>
              <div *ngIf="userForm.get('email')?.errors?.['email']">
                Format d'email invalide
              </div>
            </div>
          </div>
        </div>

        <!-- Mot de passe -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-lock-fill text-primary me-2"></i> Mot de passe*
          </label>
          <div class="col-sm-8">
            <input type="password" 
                   class="form-control" 
                   [class.is-invalid]="userForm.get('password')?.invalid && userForm.get('password')?.touched"
                   formControlName="password">
            <div class="progress mt-2" style="height: 5px;">
              <div class="progress-bar {{passwordStrengthClass}}" 
                   [style.width.%]="passwordStrength"></div>
            </div>
            <div class="invalid-feedback">
              <div *ngIf="userForm.get('password')?.errors?.['required']">
                Ce champ est obligatoire
              </div>
              <div *ngIf="userForm.get('password')?.errors?.['minlength']">
                Minimum 8 caractères
              </div>
              <div *ngIf="userForm.get('password')?.errors?.['pattern']">
                Doit contenir majuscule, minuscule et chiffre
              </div>
            </div>
          </div>
        </div>

        <!-- Confirmation mot de passe -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-lock-fill text-primary me-2"></i> Confirmation*
          </label>
          <div class="col-sm-8">
            <input type="password" 
                   class="form-control" 
                   [class.is-invalid]="userForm.hasError('passwordMismatch') && userForm.get('confirmPassword')?.touched"
                   formControlName="confirmPassword">
            <div class="invalid-feedback">
              Les mots de passe ne correspondent pas
            </div>
          </div>
        </div>

        <!-- Rôle -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-person-badge-fill text-primary me-2"></i> Rôle*
          </label>
          <div class="col-sm-8">
            <select class="form-select" 
                    [class.is-invalid]="userForm.get('role')?.invalid && userForm.get('role')?.touched"
                    formControlName="role">
              <option value="" disabled selected>Sélectionner un rôle</option>
              <option value="Administrateur">Administrateur</option>
              <option value="Validateur">Validateur</option>
              <option value="Déclarant">Declarant</option>
            </select>
            <div class="invalid-feedback">
              Veuillez sélectionner un rôle
            </div>
          </div>
        </div>

        <!-- Service -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-building text-primary me-2"></i> Service*
          </label>
          <div class="col-sm-8">
            <select class="form-select" 
                    [class.is-invalid]="userForm.get('serviceId')?.invalid && userForm.get('serviceId')?.touched"
                    formControlName="serviceId">
              <option value="" disabled selected>Sélectionner un service</option>
              <option *ngFor="let service of services" [value]="service.id">
                {{ service.nom }}
              </option>
            </select>
            <div class="invalid-feedback">
              Veuillez sélectionner un service
            </div>
          </div>
        </div>

        <!-- Téléphone -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-telephone-fill text-primary me-2"></i> Téléphone*
          </label>
          <div class="col-sm-8">
            <input type="tel" 
                   class="form-control" 
                   [class.is-invalid]="userForm.get('tel')?.invalid && userForm.get('tel')?.touched"
                   formControlName="tel">
            <div class="invalid-feedback">
              <div *ngIf="userForm.get('tel')?.errors?.['required']">
                Ce champ est obligatoire
              </div>
              <div *ngIf="userForm.get('tel')?.errors?.['pattern']">
                Format invalide (8-15 chiffres)
              </div>
            </div>
          </div>
        </div>

        <!-- Fonction -->
        <div class="row mb-3 align-items-center">
          <label class="col-sm-4 col-form-label text-end fw-semibold">
            <i class="bi bi-briefcase-fill text-primary me-2"></i> Fonction*
          </label>
          <div class="col-sm-8">
            <input type="text" 
                   class="form-control" 
                   [class.is-invalid]="userForm.get('fonction')?.invalid && userForm.get('fonction')?.touched"
                   formControlName="fonction">
            <div class="invalid-feedback">
              Ce champ est obligatoire
            </div>
          </div>
        </div>

        <!-- Bouton de soumission -->
        <div class="row mt-4">
          <div class="offset-sm-4 col-sm-8 text-end">
            <button type="submit" 
                    class="btn btn-primary px-4" 
                    [disabled]="isSubmitting || userForm.invalid">
              <span *ngIf="!isSubmitting">
                <i class="bi bi-person-plus-fill me-2"></i> Créer l'utilisateur
              </span>
              <span *ngIf="isSubmitting">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Création en cours...
              </span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</body>